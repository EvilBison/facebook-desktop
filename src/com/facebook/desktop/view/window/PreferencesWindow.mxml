<?xml version="1.0" encoding="utf-8"?>
<s:Window
		xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark" 
		xmlns:mx="library://ns.adobe.com/flex/mx"
		xmlns:component="com.facebook.desktop.view.component.*"
		minWidth="550" minHeight="525" width="{mainCanvas.width + 175}" height="{mainCanvas.height + 30}"
		transparent="true"
		systemChrome="none"
		showStatusBar="false"
		type="lightweight"
		maximizable="false"
		minimizable="false"
		resizable="false"
		styleName="popup"
		alwaysInFront="true"
		backgroundAlpha="0">

	<fx:Script>
		<![CDATA[
			import com.facebook.desktop.control.Controller;
			import com.facebook.desktop.control.preferences.PreferencesManager;
			import com.facebook.desktop.model.Model;
			
			import mx.controls.ToolTip;
			import mx.core.IUIComponent;
			import mx.events.ListEvent;
			import mx.logging.ILogger;
			import mx.logging.Log;
			import mx.managers.ToolTipManager;
			
			private static var logger:ILogger = Log.getLogger("com.facebook.preferences.PreferencesWindow");
			private static var controller:Controller = Controller.instance;
			
			[Bindable]
			private var model:Model = Model.instance;
			
			private var languageToolTip:ToolTip;
			
			public override function open(openWindowActive:Boolean = true):void
			{
				// actually open the window
				super.open(openWindowActive);
				
				// center it
				nativeWindow.x = (Capabilities.screenResolutionX - nativeWindow.width) / 2;
				nativeWindow.y = (Capabilities.screenResolutionY - nativeWindow.height) / 2;
				
				// now load up the preferences
				localeComboBox.selectedIndex = model.preferences.language;
				startAtLoginCheckbox.selected = model.preferences.startAtLogin;
				showStoriesCheckBox.selected = model.preferences.showStoryUpdates;
				showStoryActivityCheckBox.selected = model.preferences.showStoryActivity;
				friendRequestCheckBox.selected = model.preferences.showFriendRequests;
				messageCheckBox.selected = model.preferences.showMessages;
				pokeCheckBox.selected = model.preferences.showPokes;
				shareCheckBox.selected = model.preferences.showShares;
				groupInviteCheckBox.selected = model.preferences.showGroupInvites;
				eventInviteCheckBox.selected = model.preferences.showEventInvites;
				markAsReadCheckBox.selected = model.preferences.markNotificationsAsRead;
				
				// for some reason, combo-box won't drop down on first click unless it's given focus
				localeComboBox.setFocus();
				
				fadein.play();
			}  // open
			
			private function saveSettings():void
			{
				model.preferences.language = localeComboBox.selectedIndex;
				model.preferences.startAtLogin = startAtLoginCheckbox.selected;
				model.preferences.showStoryUpdates = showStoriesCheckBox.selected;
				model.preferences.showStoryActivity = showStoryActivityCheckBox.selected;
				model.preferences.showFriendRequests = friendRequestCheckBox.selected;
				model.preferences.showMessages = messageCheckBox.selected;
				model.preferences.showPokes = pokeCheckBox.selected;
				model.preferences.showShares = shareCheckBox.selected;
				model.preferences.showGroupInvites = groupInviteCheckBox.selected;
				model.preferences.showEventInvites = eventInviteCheckBox.selected;
				model.preferences.markNotificationsAsRead = markAsReadCheckBox.selected;
				
				PreferencesManager.savePreferences();
			}  // saveSettings
			
			private function changeLanguage():void
			{
				resourceManager.localeChain = [localeComboBox.selectedItem.locale];
				hideToolTip();
			}  // changeLanguage
			
			private function setStartAtLogin():void
			{
				if(!flash.system.Capabilities.isDebugger)
				{
					NativeApplication.nativeApplication.startAtLogin = startAtLoginCheckbox.selected;
				}  // if statement
			}  // setStartAtLogin
			
			private function doClose():void
			{
				controller.settingsWindowOpen = false;
				close();
			}  // doClose
			
			private function showToolTip(event:ListEvent):void
			{
				if (languageToolTip == null)
				{
					languageToolTip = ToolTipManager.createToolTip(event.itemRenderer.data.toolTip,
						localeComboBox.x + localeComboBox.width + event.itemRenderer.x,
						110 + event.itemRenderer.y,
						"errorTipRight",
						IUIComponent(event.currentTarget)) as ToolTip;
					languageToolTip.setStyle("styleName", "toolTip");
				}  // if statement
				else
				{
					languageToolTip.text = event.itemRenderer.data.toolTip;
					languageToolTip.y = 110 + event.itemRenderer.y;
				}  // else statement
				
				languageToolTip.visible = true;
			}  // showToolTip
			
			private function hideToolTip():void
			{
				if (languageToolTip != null)
				{
					languageToolTip.visible = false;
				}  // if statement
			}  // hideToolTip
		]]>
	</fx:Script>
	
	<fx:Declarations>
		<mx:Fade id="fadein"
				 target="{this}"
				 alphaFrom="0"
				 alphaTo="1"
				 duration="300" />
		<mx:Fade id="fadeout"
				 target="{this}"
				 alphaFrom="1"
				 alphaTo="0"
				 duration="300"
				 effectEnd="doClose()" />
	</fx:Declarations>
	
	<fx:Style source="/com/facebook/desktop/view/style/style.css" />
	
	<mx:VBox cornerRadius="8" backgroundColor="black" backgroundAlpha="0.4" width="{mainCanvas.width + 25}" height="{mainCanvas.height + 25}" verticalAlign="middle" paddingTop="12" paddingBottom="12" paddingLeft="12" paddingRight="12">
		<mx:VBox id="mainCanvas" minWidth="525" minHeight="500" backgroundColor="white">
			<mx:VBox width="100%" height="35" backgroundColor="#6d84b4" verticalAlign="middle" paddingLeft="12">
				<s:Label text="{resourceManager.getString('resources','preferences.title')}" fontSize="17" color="white" />
			</mx:VBox>
			<mx:HBox minHeight="410" width="100%">
				<mx:VBox paddingLeft="15" paddingRight="15" paddingTop="15" paddingBottom="15" width="100%">
					<mx:HBox verticalAlign="middle">
						<s:Label text="{resourceManager.getString('resources','preferences.applicationSettings.header')}" fontWeight="bold" />
					</mx:HBox>
					
					<mx:HRule width="100%" />
					
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.applicationSettings.option.language')}" />
						<mx:Spacer width="100%" />
						<mx:ComboBox id="localeComboBox" itemRollOver="showToolTip(event)" itemRollOut="hideToolTip()" rollOut="hideToolTip()" dataProvider="{model.locales}" change="saveSettings();changeLanguage();logger.info('Changing \'Language\' setting to {0}',localeComboBox.selectedItem.label)"/>
					</mx:HBox>
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.applicationSettings.option.runOnStartup')}" />
						<mx:Spacer width="100%" />
						<s:CheckBox id="startAtLoginCheckbox" change="saveSettings();setStartAtLogin();logger.info('Changing \'Run on startup\' setting to {0}',startAtLoginCheckbox.selected)" />
					</mx:HBox>
					
					
					<mx:Spacer height="15" />
					<mx:HBox verticalAlign="middle">
						<s:Label text="{resourceManager.getString('resources','preferences.notificationSettings.header')}" fontWeight="bold" />
					</mx:HBox>
					<mx:HRule width="100%" />
					
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.notificationSettings.option.notifyNewStories')}" />
						<mx:Spacer width="100%" />
						<s:CheckBox id="showStoriesCheckBox" change="saveSettings();logger.info('Changing \'Notify me when new stories are posted to my stream\' setting to {0}',showStoriesCheckBox.selected)" />
					</mx:HBox>
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.notificationSettings.option.notifyActivity')}" />
						<mx:Spacer width="100%" />
						<s:CheckBox id="showStoryActivityCheckBox" change="saveSettings();logger.info('Changing \'Notify me when there is activity in a post that I am in or have participated in\' setting to {0}',showStoriesCheckBox.selected)" />
					</mx:HBox>
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.notificationSettings.option.notifyFriendRequest')}" />
						<mx:Spacer width="100%" />
						<s:CheckBox id="friendRequestCheckBox" change="saveSettings();logger.info('Changing \'Notify me when I get a new friend request\' setting to {0}',friendRequestCheckBox.selected)" />
					</mx:HBox>
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.notificationSettings.option.notifyMessage')}" />
						<mx:Spacer width="100%" />
						<s:CheckBox id="messageCheckBox" change="saveSettings();logger.info('Changing \'Notify me when someone sends me a message\' setting to {0}',messageCheckBox.selected)" />
					</mx:HBox>
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.notificationSettings.option.notifyPoke')}" />
						<mx:Spacer width="100%" />
						<s:CheckBox id="pokeCheckBox" change="saveSettings();logger.info('Changing \'Notify me when someone pokes me\' setting to {0}',pokeCheckBox.selected)" />
					</mx:HBox>
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.notificationSettings.option.notifyShare')}" />
						<mx:Spacer width="100%" />
						<s:CheckBox id="shareCheckBox" change="saveSettings();logger.info('Changing \'Notify me when someone shares something with me\' setting to {0}',shareCheckBox.selected)" />
					</mx:HBox>
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.notificationSettings.option.notifyGroupInvite')}" />
						<mx:Spacer width="100%" />
						<s:CheckBox id="groupInviteCheckBox" change="saveSettings();logger.info('Changing \'Notify me when I get a group invite\' setting to {0}',groupInviteCheckBox.selected)" />
					</mx:HBox>
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.notificationSettings.option.notifyEventInvite')}" />
						<mx:Spacer width="100%" />
						<s:CheckBox id="eventInviteCheckBox" change="saveSettings();logger.info('Changing \'Notify me when I get an event invite\' setting to {0}',eventInviteCheckBox.selected)" />
					</mx:HBox>
					
					<mx:Spacer height="15" />
					<mx:HBox verticalAlign="middle">
						<s:Label text="{resourceManager.getString('resources','preferences.profileSettings.header')}" fontWeight="bold" />
					</mx:HBox>
					<mx:HRule width="100%" />
					
					<mx:HBox verticalAlign="middle" width="100%">
						<s:Label text="{resourceManager.getString('resources','preferences.profileSettings.option.markNotificationsRead')}" />
						<mx:Spacer width="100%" />
						<s:CheckBox id="markAsReadCheckBox" change="saveSettings();logger.info('Changing \'Mark notifications as read when they appear on my screen\' setting to {0}',markAsReadCheckBox.selected)" />
					</mx:HBox>
				</mx:VBox>
			</mx:HBox>
			<mx:HBox minHeight="43" width="100%" backgroundColor="#f2f2f2" verticalAlign="middle" horizontalAlign="right" paddingRight="12" paddingTop="9" paddingBottom="9">
				<component:FacebookButton click="fadeout.play()" text="{resourceManager.getString('resources','component.button.okay')}" />
			</mx:HBox>
		</mx:VBox>
	</mx:VBox>
	
</s:Window>
